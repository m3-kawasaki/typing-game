# タイピングゲーム 仕様書

## 概要
- **目的**: ブラウザで動く、シンプルで気持ちよく遊べる15秒タイピングゲームを提供する。
- **特徴**: 単語は外部テキストで差し替え可能。タイプミスは色やアニメで強調。単語完了で達成演出と効果音。
- **技術**: 純フロントエンド（HTML/CSS/JavaScript）。静的ホスティングで動作、バックエンド不要。
- **言語**: 開発中のやり取り・UI・ドキュメントは日本語で統一する。
- **構成**: シンプルな構成（単一ページ＋最小アセット）を維持する。

## ゲームプレイ
- **制限時間**: デフォルト15秒（設定で変更可）。
- **目的**: 表示された単語を左から順に正しくタイプし、完了数と精度を競う。
- **進行**: 単語は1つずつ表示。完了すると即座に次の単語へ遷移。
- **終了**: タイマー0でラウンド終了。結果（完了単語数、精度、CPM/WPM、最高記録）を表示。
- **ポーズ**: フォーカス外れで自動一時停止（設定で無効化可）。

## 入力・判定仕様
- **カーソル表示**: 現在位置の文字を強調（下線または点滅）。
- **正打**: 正しいキーで1文字進行。入力済みは緑、未入力は通常色。
- **ミス**: 誤キーは赤表示＋短いシェイク。ミス音を再生（設定で無効化可）。
- **ミス処理モード**:
  - 既定「修正必須」: ミス位置から進まない。`Backspace`で修正後に続行。
  - 代替「寛容」: 誤入力でも進むが、その単語はミス扱い（精度に反映）。
- **大文字小文字**: 既定で区別（設定で無視可）。全角/半角は単語リストに従う。
- **無効キー**: `Tab`や修飾キーは無視。`Enter`は開始/リスタート（フォーカス時）。

## 単語リスト管理
- **形式**: 行区切りのプレーンテキスト `assets/words.txt`。1行=1単語。空行・`#`始まりは無視。
- **差し替え方法**:
  1. デプロイ先で同名ファイルを置き換え。
  2. UIの「単語リストを読み込む」から`.txt`をインポート（ローカル開き時のCORS対策）。
- **選出**: ランダム抽選（直前と同一単語の連続出現は回避）。
- **文字種**: ASCII/日本語含むマルチバイト対応。前後空白はトリム。

## UI / 画面構成
- **ヘッダー**: タイトル、設定ボタン、サウンド切替。
- **プレイエリア**:
  - 現在の単語を大きく表示。`correct`（緑）、`current`（強調）、`error`（赤）クラスで装飾。
  - タイマーバー（上部）。残り時間で幅が縮む。残5秒でオレンジ→赤。
- **フッター**: 現在スコア（完了数、精度%、CPM/WPM）、リスタートボタン。
- **結果ダイアログ**: ラウンド統計、ハイスコア、再挑戦、単語リストインポート。
- **デザイン**: シンプル・余白多め。ライト/ダーク自動対応（メディアクエリ）。色弱配慮（色＋形/動き）。

## 演出・サウンド
- **ミス演出**: 0.2秒のシェイク、文字赤色、端末対応時は軽い振動（Vibration API）。
- **成功演出**: 単語完了で軽い拡大→フェード、次単語フェードイン。控えめなグロー。
- **サウンド**:
  - `success.wav`（単語完了）
  - `error.wav`（ミス）
  - `tick.wav`（残5秒から1Hz）
  - ミュート切替・音量調整可。設定は保存。

## スコアリング
- **完了単語数**: 最後まで正しく打ち切った単語の数。
- **精度**: 正打キー数 / 総キー入力数。
- **CPM/WPM**: 正打ベース（WPM=CPM/5）。小数1桁表示。
- **連続成功**: 連続完了数（任意表示、将来的なコンボ演出に利用）。
- **ハイスコア**: 端末ローカル保存（`localStorage`）。

## タイマー・設定
- **制限時間**: 既定`15`秒（最小5〜最大120秒）。
- **開始**: `Enter`または「スタート」クリックで計測開始。
- **一時停止**: 設定ON時、フォーカス喪失で自動停止・復帰。
- **設定UI**: モーダルで以下を切替
  - 制限時間（秒）
  - 大文字小文字の区別（ON/OFF）
  - ミス処理モード（修正必須/寛容）
  - サウンド（ON/OFF、音量）
  - ポーズ挙動（ON/OFF）
- **保存**: `localStorage`に永続化。初回は既定値使用。

## アクセシビリティ
- **キーボード操作**: 全操作をキーボードで可能に。フォーカスリング明確化。
- **色依存回避**: ミス時は下線やアイコンも併用。
- **スクリーンリーダ**: 単語更新を`aria-live="polite"`で通知。装飾は`aria-hidden`。
- **音量配慮**: 初回は音量控えめ。ミュートはワンアクション。

## パフォーマンス / 対応環境
- **対応**: 最新 Chromium / Firefox / Safari / Edge。モバイルは横画面推奨。
- **オフライン**: 将来PWA化可能（任意）。音声は事前ロード。
- **フレーム**: CSSトランジション中心、`requestAnimationFrame`活用。60fps目標。

## エラー処理
- **単語読み込み失敗**: デフォルト内蔵リストにフォールバックし、トースト通知。
- **空リスト**: スタート不可。インポートを促すUI表示。
- **音声読み込み失敗**: サイレントにフォールバックし、ミュート切替を案内。

## ファイル構成（提案）
```
index.html           # 画面構造・初期UI
styles.css           # テーマ、色、アニメ（.shake, .glow）
main.js              # ゲームロジック、入力、状態、統計
config.json          # 初期設定（時間、モード、閾値）
assets/words.txt     # 単語リスト（差し替え対象）
assets/sfx/success.wav
assets/sfx/error.wav
assets/sfx/tick.wav
assets/icons/*       # UI用アイコン（SVG）
```

## データ仕様
- `assets/words.txt`
  - UTF-8
  - 1行=1単語
  - 空行・`#`で始まる行は無視
- `config.json`
  - `durationSeconds`: number（default 15）
  - `caseSensitive`: boolean（default true）
  - `mistakeMode`: "strict" | "lenient"（default "strict"）
  - `sound`: `{ enabled: boolean, volume: number(0–1) }`（default `{ true, 0.3 }`）
  - `pauseOnBlur`: boolean（default true）

## 状態遷移
```
Idle →（スタート）→ Playing →（時間切れ）→ Result →（再戦）→ Idle
Playing ↔（フォーカス喪失/復帰）↔ Paused（任意）
```

## 受け入れ基準（抜粋）
- 単語が1語ずつ表示され、完了時に次語へ即時遷移する。
- ミス入力で赤色とシェイクが発生し、サウンドが鳴る（ミュート時除く）。
- 単語完了で成功演出と成功音が鳴る。
- 既定の制限時間は15秒で、設定から変更・保存できる。
- `assets/words.txt`差し替え、またはUIインポートで出題が切り替わる。
- 結果画面に完了単語数・精度・CPM/WPM・ハイスコアが表示される。
- 主要ブラウザ現行版で動作し、読み込み失敗時のフォールバックがある。

## 実装メモ（参考）
- **ローダ**: 初回に`config.json`→`words.txt`を`fetch`。ローカル直開き対策でインポートUIも用意。
- **状態管理**: `gameState = { status, timeLeft, currentWord, index, stats }`の単一オブジェクト。
- **描画**: 単語を文字ごとに`span`化し、`correct`/`current`/`error`クラス付与。
- **タイマー**: `setInterval(100ms)`で残り時間更新（バーは幅%で反映）。
- **音**: `AudioContext`または`HTMLAudioElement`で事前デコード・再生。ユーザ操作後に解放。
- **保存**: 設定・ハイスコアは`localStorage`（名前空間 `typingGame:*`）。

## 将来拡張（任意）
- 難易度（語長・頻度）調整、重み付け選出。
- コンボ演出、デイリーチャレンジ、PWA対応。
- 多言語リスト切替、ネットワーク共有ランキング（サーバ必要）。
